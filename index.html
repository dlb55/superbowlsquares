<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Super Bowl Squares 2025</title>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;500;600;700&family=Bebas+Neue&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <style>
        :root {
            --gold: #D4AF37;
            --gold-light: #F4D03F;
            --dark: #0a0a0a;
            --dark-secondary: #1a1a1a;
            --dark-tertiary: #2a2a2a;
            --green-field: #2d5a27;
            --white: #ffffff;
            --red: #c41e3a;
            --success: #22c55e;
            --team-x-bg: #ffffff;
            --team-x-text: #0a0a0a;
            --team-y-bg: #D4AF37;
            --team-y-text: #0a0a0a;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background: var(--dark);
            color: var(--white);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Stadium lights effect */
        body::before {
            content: '';
            position: fixed;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(ellipse at 30% 20%, rgba(212, 175, 55, 0.08) 0%, transparent 50%),
                        radial-gradient(ellipse at 70% 20%, rgba(212, 175, 55, 0.08) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        .app-container {
            position: relative;
            z-index: 1;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            text-align: center;
            padding: 40px 20px;
            position: relative;
        }

        .header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            height: 3px;
            background: linear-gradient(90deg, transparent, var(--gold), transparent);
        }

        .logo {
            font-family: 'Bebas Neue', sans-serif;
            font-size: clamp(2.5rem, 8vw, 4.5rem);
            letter-spacing: 4px;
            background: linear-gradient(180deg, var(--gold-light) 0%, var(--gold) 50%, #8B7355 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 4px 30px rgba(212, 175, 55, 0.3);
            margin-bottom: 10px;
        }

        .price-badge {
            display: inline-block;
            margin-top: 10px;
            padding: 10px 30px;
            background: linear-gradient(135deg, var(--gold) 0%, #8B7355 100%);
            color: var(--dark);
            font-family: 'Oswald', sans-serif;
            font-weight: 600;
            font-size: 1.2rem;
            border-radius: 4px;
            letter-spacing: 1px;
        }

        .payouts-info {
            margin-top: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
            font-family: 'Oswald', sans-serif;
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.8);
            letter-spacing: 0.5px;
        }

        .payouts-label {
            color: rgba(255, 255, 255, 0.5);
            margin-right: 4px;
        }

        .payout-item strong {
            color: var(--gold);
        }

        .payout-divider {
            color: var(--gold);
            opacity: 0.5;
        }

        /* Stats Bar */
        .stats-bar {
            display: flex;
            justify-content: center;
            gap: 40px;
            padding: 20px;
            margin: 30px 0;
            background: var(--dark-secondary);
            border-radius: 8px;
            border: 1px solid var(--dark-tertiary);
            flex-wrap: wrap;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2.5rem;
            color: var(--gold);
        }

        .stat-label {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.5);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Navigation */
        .nav-tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .nav-tab {
            padding: 12px 30px;
            background: var(--dark-secondary);
            border: 2px solid var(--dark-tertiary);
            color: var(--white);
            font-family: 'Oswald', sans-serif;
            font-size: 1rem;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 4px;
        }

        .nav-tab:hover {
            border-color: var(--gold);
            color: var(--gold);
        }

        .nav-tab.active {
            background: var(--gold);
            color: var(--dark);
            border-color: var(--gold);
        }

        /* Grid Container */
        .grid-container {
            background: var(--dark-secondary);
            border-radius: 12px;
            padding: 20px;
            border: 2px solid var(--dark-tertiary);
            overflow-x: auto;
        }

        .teams-header {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
            padding: 0 10px;
        }

        .team-name {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.8rem;
            letter-spacing: 2px;
            padding: 8px 20px;
            border-radius: 6px;
        }

        .team-name.team-x {
            background: var(--team-x-bg);
            color: var(--team-x-text);
        }

        .team-name.team-y {
            background: var(--team-y-bg);
            color: var(--team-y-text);
            writing-mode: vertical-rl;
            text-orientation: mixed;
            transform: rotate(180deg);
            padding: 20px 8px;
        }

        /* The Grid */
        .squares-wrapper {
            display: flex;
            justify-content: center;
            align-items: stretch;
            gap: 10px;
        }

        .team-y-wrapper {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Quarter Key */
        .quarter-key {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 10px;
            margin-bottom: 15px;
            padding: 8px 12px;
            background: var(--dark);
            border-radius: 6px;
            border: 1px solid var(--dark-tertiary);
            width: fit-content;
            margin-left: auto;
        }

        .quarter-key-title {
            font-family: 'Oswald', sans-serif;
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.5);
            letter-spacing: 0.5px;
        }

        .quarter-key-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            grid-template-rows: repeat(2, 1fr);
            gap: 2px;
            width: 44px;
            height: 28px;
        }

        .quarter-key-cell {
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Oswald', sans-serif;
            font-size: 0.6rem;
            font-weight: 600;
            border-radius: 2px;
        }

        .quarter-key-cell.q1 { background: rgba(212, 175, 55, 0.3); color: var(--gold); }
        .quarter-key-cell.q2 { background: rgba(212, 175, 55, 0.22); color: var(--gold); }
        .quarter-key-cell.q3 { background: rgba(212, 175, 55, 0.15); color: var(--gold); }
        .quarter-key-cell.q4 { background: rgba(212, 175, 55, 0.08); color: var(--gold); }

        .squares-grid {
            display: grid;
            grid-template-columns: 80px repeat(10, minmax(50px, 70px));
            gap: 2px;
            background: var(--dark-tertiary);
            padding: 2px;
            border-radius: 8px;
        }

        .number-header {
            background: var(--dark);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 5px;
            font-family: 'Oswald', sans-serif;
            min-height: 60px;
        }

        .number-header.corner {
            background: linear-gradient(135deg, var(--gold) 0%, #8B7355 100%);
        }

        .quarter-numbers {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            grid-template-rows: repeat(2, 1fr);
            gap: 2px;
            width: 100%;
            height: 100%;
        }

        .quarter-num {
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 2px;
            color: var(--gold);
            font-weight: 600;
        }

        .quarter-num.q1 { background: rgba(212, 175, 55, 0.3); }
        .quarter-num.q2 { background: rgba(212, 175, 55, 0.22); }
        .quarter-num.q3 { background: rgba(212, 175, 55, 0.15); }
        .quarter-num.q4 { background: rgba(212, 175, 55, 0.08); }

        .row-header {
            background: var(--dark);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 5px;
            font-family: 'Oswald', sans-serif;
        }

        .square {
            aspect-ratio: 1;
            min-width: 50px;
            min-height: 50px;
            background: var(--green-field);
            border: 2px solid transparent;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.7rem;
            text-align: center;
            padding: 4px;
            word-break: break-word;
            font-weight: 500;
            position: relative;
            overflow: hidden;
        }

        .square::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, transparent 50%);
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .square:hover:not(.taken) {
            border-color: var(--gold);
            transform: scale(1.05);
            z-index: 10;
        }

        .square:hover::before {
            opacity: 1;
        }

        .square.taken {
            background: var(--dark-tertiary);
            cursor: default;
            color: rgba(255, 255, 255, 0.8);
        }

        .square.selected {
            background: var(--gold);
            color: var(--dark);
            border-color: var(--gold-light);
            font-weight: 600;
        }

        .square.selected::after {
            content: '‚úì';
            position: absolute;
            top: 2px;
            right: 4px;
            font-size: 0.6rem;
        }

        /* Selection Panel */
        .selection-panel {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--dark-secondary);
            border-top: 3px solid var(--gold);
            padding: 20px;
            transform: translateY(100%);
            transition: transform 0.3s ease;
            z-index: 100;
        }

        .selection-panel.active {
            transform: translateY(0);
        }

        .selection-content {
            max-width: 800px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
            flex-wrap: wrap;
        }

        .selection-info {
            flex: 1;
        }

        .selection-count {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.5rem;
            color: var(--gold);
        }

        .selection-total {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
        }

        .selection-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 12px 30px;
            font-family: 'Oswald', sans-serif;
            font-size: 1rem;
            letter-spacing: 1px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--gold) 0%, #8B7355 100%);
            color: var(--dark);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(212, 175, 55, 0.4);
        }

        .btn-secondary {
            background: transparent;
            border: 2px solid var(--dark-tertiary);
            color: var(--white);
        }

        .btn-secondary:hover {
            border-color: var(--white);
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            padding: 20px;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: var(--dark-secondary);
            border-radius: 12px;
            padding: 40px;
            max-width: 500px;
            width: 100%;
            border: 2px solid var(--gold);
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .modal-overlay.active .modal {
            transform: scale(1);
        }

        .modal-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2rem;
            color: var(--gold);
            margin-bottom: 20px;
            text-align: center;
        }

        .modal-input {
            width: 100%;
            padding: 15px;
            background: var(--dark);
            border: 2px solid var(--dark-tertiary);
            border-radius: 6px;
            color: var(--white);
            font-size: 1rem;
            margin-bottom: 20px;
            transition: border-color 0.2s ease;
        }

        .modal-input:focus {
            outline: none;
            border-color: var(--gold);
        }

        .modal-summary {
            background: var(--dark);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid var(--dark-tertiary);
        }

        .summary-row:last-child {
            border-bottom: none;
            font-weight: 600;
            color: var(--gold);
            font-size: 1.2rem;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
        }

        .modal-actions .btn {
            flex: 1;
        }

        /* Success Modal */
        .success-icon {
            width: 80px;
            height: 80px;
            background: var(--success);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 2.5rem;
        }

        .payment-info {
            background: var(--dark);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .payment-method {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px 0;
            border-bottom: 1px solid var(--dark-tertiary);
        }

        .payment-method:last-child {
            border-bottom: none;
        }

        .payment-icon {
            width: 50px;
            height: 50px;
            background: var(--dark-tertiary);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: var(--gold);
        }

        .payment-details {
            flex: 1;
        }

        .payment-label {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.5);
            margin-bottom: 4px;
        }

        .payment-value {
            font-weight: 500;
            color: var(--white);
        }

        /* Admin Panel */
        .admin-panel {
            display: none;
        }

        .admin-panel.active {
            display: block;
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .admin-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2rem;
            color: var(--gold);
        }

        .admin-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .admin-table-container {
            background: var(--dark-secondary);
            border-radius: 12px;
            overflow: hidden;
            border: 2px solid var(--dark-tertiary);
        }

        .admin-table {
            width: 100%;
            border-collapse: collapse;
        }

        .admin-table th,
        .admin-table td {
            padding: 15px 20px;
            text-align: left;
            border-bottom: 1px solid var(--dark-tertiary);
        }

        .admin-table th {
            background: var(--dark);
            font-family: 'Oswald', sans-serif;
            font-weight: 500;
            letter-spacing: 1px;
            color: var(--gold);
        }

        .admin-table tr:hover {
            background: rgba(255, 255, 255, 0.02);
        }

        .status-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .status-paid {
            background: rgba(34, 197, 94, 0.2);
            color: var(--success);
        }

        .status-pending {
            background: rgba(212, 175, 55, 0.2);
            color: var(--gold);
        }

        .toggle-btn {
            padding: 8px 16px;
            background: transparent;
            border: 1px solid var(--dark-tertiary);
            color: var(--white);
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s ease;
        }

        .toggle-btn:hover {
            border-color: var(--gold);
            color: var(--gold);
        }

        /* Quarter Numbers Section */
        .numbers-section {
            margin-top: 30px;
        }

        .numbers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .quarter-card {
            background: var(--dark-secondary);
            border-radius: 12px;
            padding: 20px;
            border: 2px solid var(--dark-tertiary);
        }

        .quarter-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.3rem;
            color: var(--gold);
            margin-bottom: 15px;
            text-align: center;
        }

        .numbers-display {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 5px;
        }

        .num-cell {
            aspect-ratio: 1;
            background: var(--dark);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.9rem;
            border-radius: 4px;
        }

        /* Password Modal */
        .password-input {
            width: 100%;
            padding: 15px;
            background: var(--dark);
            border: 2px solid var(--dark-tertiary);
            border-radius: 6px;
            color: var(--white);
            font-size: 1rem;
            margin-bottom: 20px;
        }

        .password-input:focus {
            outline: none;
            border-color: var(--gold);
        }

        /* Legend */
        .legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.6);
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }

        .legend-color.available {
            background: var(--green-field);
        }

        .legend-color.selected {
            background: var(--gold);
        }

        .legend-color.taken {
            background: var(--dark-tertiary);
        }

        /* Admin Footer */
        .admin-footer {
            margin-top: 40px;
            text-align: center;
            padding: 20px;
        }

        .admin-login-btn {
            background: transparent;
            border: 1px solid var(--dark-tertiary);
            color: rgba(255, 255, 255, 0.4);
            padding: 8px 20px;
            font-family: 'Oswald', sans-serif;
            font-size: 0.85rem;
            letter-spacing: 1px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .admin-login-btn:hover {
            border-color: var(--gold);
            color: var(--gold);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .squares-grid {
                grid-template-columns: 60px repeat(10, minmax(40px, 50px));
            }

            .square {
                min-width: 40px;
                min-height: 40px;
                font-size: 0.6rem;
            }

            .number-header {
                min-height: 50px;
            }

            .quarter-num {
                font-size: 0.6rem;
            }

            .selection-content {
                flex-direction: column;
                text-align: center;
            }

            .admin-table th,
            .admin-table td {
                padding: 10px;
                font-size: 0.85rem;
            }
        }

        /* Loading State */
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 400px;
            gap: 20px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 3px solid var(--dark-tertiary);
            border-top-color: var(--gold);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .error-message {
            background: rgba(196, 30, 58, 0.2);
            border: 1px solid var(--red);
            color: var(--white);
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }

        /* Admin Customization Sections */
        .admin-section-card {
            background: var(--dark-secondary);
            border-radius: 12px;
            padding: 25px;
            border: 2px solid var(--dark-tertiary);
            margin-bottom: 30px;
        }

        .admin-section-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.5rem;
            color: var(--gold);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--dark-tertiary);
        }

        .team-settings {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
        }

        .team-config {
            background: var(--dark);
            padding: 20px;
            border-radius: 8px;
        }

        .team-config-title {
            font-family: 'Oswald', sans-serif;
            font-size: 1.1rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .team-preview {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 0.9rem;
        }

        .config-row {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .config-row:last-child {
            margin-bottom: 0;
        }

        .config-label {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.6);
            min-width: 100px;
        }

        .config-input {
            flex: 1;
            padding: 10px 12px;
            background: var(--dark-secondary);
            border: 2px solid var(--dark-tertiary);
            border-radius: 6px;
            color: var(--white);
            font-size: 0.95rem;
            transition: border-color 0.2s ease;
        }

        .config-input:focus {
            outline: none;
            border-color: var(--gold);
        }

        .color-picker-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
        }

        .color-picker {
            width: 50px;
            height: 40px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            background: transparent;
        }

        .color-picker::-webkit-color-swatch-wrapper {
            padding: 0;
        }

        .color-picker::-webkit-color-swatch {
            border: 2px solid var(--dark-tertiary);
            border-radius: 6px;
        }

        .color-hex {
            font-family: monospace;
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.5);
        }

        /* Quarter Numbers Editor */
        .quarter-editor {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .quarter-edit-card {
            background: var(--dark);
            padding: 20px;
            border-radius: 8px;
        }

        .quarter-edit-title {
            font-family: 'Oswald', sans-serif;
            font-size: 1.1rem;
            color: var(--gold);
            margin-bottom: 15px;
            text-align: center;
        }

        .numbers-edit-row {
            margin-bottom: 15px;
        }

        .numbers-edit-label {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.5);
            margin-bottom: 8px;
        }

        .numbers-edit-grid {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 4px;
        }

        .number-input {
            width: 100%;
            aspect-ratio: 1;
            text-align: center;
            background: var(--dark-secondary);
            border: 1px solid var(--dark-tertiary);
            border-radius: 4px;
            color: var(--gold);
            font-weight: 600;
            font-size: 0.85rem;
            padding: 0;
        }

        .number-input:focus {
            outline: none;
            border-color: var(--gold);
            background: var(--dark-tertiary);
        }

        .number-input::placeholder {
            color: rgba(255, 255, 255, 0.2);
        }

        .quarter-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .quarter-actions .btn {
            flex: 1;
            padding: 8px 12px;
            font-size: 0.85rem;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.85rem;
        }

        .btn-danger {
            background: rgba(196, 30, 58, 0.3);
            border: 1px solid var(--red);
            color: var(--white);
        }

        .btn-danger:hover {
            background: rgba(196, 30, 58, 0.5);
        }
    </style>
</head>
<body>
    <div class="app-container">
        <header class="header">
            <h1 class="logo">SUPER BOWL SQUARES</h1>
            <div class="price-badge">$25 PER SQUARE</div>
            <div class="payouts-info">
                <span class="payouts-label">PAYOUTS:</span>
                <span class="payout-item"><strong>Q1:</strong> $500</span>
                <span class="payout-divider">‚Ä¢</span>
                <span class="payout-item"><strong>Q2:</strong> $625</span>
                <span class="payout-divider">‚Ä¢</span>
                <span class="payout-item"><strong>Q3:</strong> $500</span>
                <span class="payout-divider">‚Ä¢</span>
                <span class="payout-item"><strong>Q4:</strong> $875</span>
            </div>
        </header>

        <div class="stats-bar">
            <div class="stat-item">
                <div class="stat-value" id="availableCount">100</div>
                <div class="stat-label">Available</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="takenCount">0</div>
                <div class="stat-label">Taken</div>
            </div>
        </div>

        <div id="loadingState" class="loading">
            <div class="spinner"></div>
            <p>Loading squares...</p>
        </div>

        <div id="errorState" class="error-message" style="display: none;"></div>

        <!-- Main Grid Section -->
        <section id="gridSection" class="grid-section" style="display: none;">
            <div class="grid-container">
                <!-- Quarter Key Legend -->
                <div class="quarter-key">
                    <div class="quarter-key-title">Quarter Number Key:</div>
                    <div class="quarter-key-grid">
                        <div class="quarter-key-cell q1">Q1</div>
                        <div class="quarter-key-cell q2">Q2</div>
                        <div class="quarter-key-cell q3">Q3</div>
                        <div class="quarter-key-cell q4">Q4</div>
                    </div>
                </div>

                <!-- NFC Team Header (Top) -->
                <div class="teams-header">
                    <span class="team-name team-x" id="teamXName">NFC TEAM</span>
                </div>

                <div class="squares-wrapper">
                    <!-- AFC Team Label (Side) -->
                    <div class="team-y-wrapper">
                        <span class="team-name team-y" id="teamYName">AFC TEAM</span>
                    </div>
                    
                    <div class="squares-grid" id="squaresGrid">
                        <!-- Grid will be generated by JavaScript -->
                    </div>
                </div>

                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color available"></div>
                        <span>Available</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color selected"></div>
                        <span>Your Selection</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color taken"></div>
                        <span>Taken</span>
                    </div>
                </div>
            </div>

            <!-- Admin Login at Bottom -->
            <div class="admin-footer">
                <button class="admin-login-btn" id="adminLoginBtn">Admin Login</button>
            </div>
        </section>

        <!-- Admin Section -->
        <section id="adminSection" class="admin-panel">
            <div class="admin-header">
                <h2 class="admin-title">Admin Dashboard</h2>
                <div class="admin-actions">
                    <button class="btn btn-secondary" id="exportBtn">Export Data</button>
                    <button class="btn btn-secondary" id="resetGridBtn">Reset All Squares</button>
                    <button class="btn btn-primary" id="backToGridBtn">Back to Grid</button>
                </div>
            </div>

            <!-- Team Customization -->
            <div class="admin-section-card">
                <h3 class="admin-section-title">Team Settings</h3>
                <div class="team-settings">
                    <div class="team-config">
                        <div class="team-config-title">
                            NFC Team (Columns - Top) 
                            <span class="team-preview" id="teamXPreview">NFC TEAM</span>
                        </div>
                        <div class="config-row">
                            <span class="config-label">Team Name</span>
                            <input type="text" class="config-input" id="teamXNameInput" placeholder="e.g., Eagles" maxlength="20">
                        </div>
                        <div class="config-row">
                            <span class="config-label">Background</span>
                            <div class="color-picker-wrapper">
                                <input type="color" class="color-picker" id="teamXBgColor" value="#ffffff">
                                <span class="color-hex" id="teamXBgHex">#ffffff</span>
                            </div>
                        </div>
                        <div class="config-row">
                            <span class="config-label">Text Color</span>
                            <div class="color-picker-wrapper">
                                <input type="color" class="color-picker" id="teamXTextColor" value="#0a0a0a">
                                <span class="color-hex" id="teamXTextHex">#0a0a0a</span>
                            </div>
                        </div>
                    </div>
                    <div class="team-config">
                        <div class="team-config-title">
                            AFC Team (Rows - Side)
                            <span class="team-preview" id="teamYPreview">AFC TEAM</span>
                        </div>
                        <div class="config-row">
                            <span class="config-label">Team Name</span>
                            <input type="text" class="config-input" id="teamYNameInput" placeholder="e.g., Chiefs" maxlength="20">
                        </div>
                        <div class="config-row">
                            <span class="config-label">Background</span>
                            <div class="color-picker-wrapper">
                                <input type="color" class="color-picker" id="teamYBgColor" value="#D4AF37">
                                <span class="color-hex" id="teamYBgHex">#D4AF37</span>
                            </div>
                        </div>
                        <div class="config-row">
                            <span class="config-label">Text Color</span>
                            <div class="color-picker-wrapper">
                                <input type="color" class="color-picker" id="teamYTextColor" value="#0a0a0a">
                                <span class="color-hex" id="teamYTextHex">#0a0a0a</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div style="margin-top: 20px; text-align: center;">
                    <button class="btn btn-primary" id="saveTeamSettingsBtn">Save Team Settings</button>
                </div>
            </div>

            <!-- Quarter Numbers Editor -->
            <div class="admin-section-card">
                <h3 class="admin-section-title">Quarter Numbers</h3>
                <p style="color: rgba(255,255,255,0.5); margin-bottom: 20px; font-size: 0.9rem;">
                    Enter numbers 0-9 for each position, or use "Random" to auto-generate. Leave as "?" until ready to reveal.
                </p>
                <div class="quarter-editor" id="quarterEditor">
                    <!-- Quarter edit cards will be generated -->
                </div>
            </div>

            <!-- Participants Table -->
            <div class="admin-section-card">
                <h3 class="admin-section-title">Participants & Payments</h3>
                <div class="admin-table-container">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Squares</th>
                                <th>Total Due</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="adminTableBody">
                            <!-- Rows will be generated -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>
    </div>

    <!-- Selection Panel -->
    <div class="selection-panel" id="selectionPanel">
        <div class="selection-content">
            <div class="selection-info">
                <div class="selection-count"><span id="selectedCount">0</span> Squares Selected</div>
                <div class="selection-total">Total: $<span id="selectedTotal">0</span></div>
            </div>
            <div class="selection-actions">
                <button class="btn btn-secondary" id="clearSelectionBtn">Clear</button>
                <button class="btn btn-primary" id="confirmSelectionBtn">Confirm Selection</button>
            </div>
        </div>
    </div>

    <!-- Name Entry Modal -->
    <div class="modal-overlay" id="nameModal">
        <div class="modal">
            <h2 class="modal-title">Enter Your Name</h2>
            <input type="text" class="modal-input" id="playerName" placeholder="Your Name" maxlength="15">
            <div class="modal-summary">
                <div class="summary-row">
                    <span>Squares Selected</span>
                    <span id="summaryCount">0</span>
                </div>
                <div class="summary-row">
                    <span>Price per Square</span>
                    <span>$25</span>
                </div>
                <div class="summary-row">
                    <span>Total Amount</span>
                    <span>$<span id="summaryTotal">0</span></span>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" id="cancelNameBtn">Cancel</button>
                <button class="btn btn-primary" id="submitNameBtn">Lock In Squares</button>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div class="modal-overlay" id="successModal">
        <div class="modal">
            <div class="success-icon">üèà</div>
            <h2 class="modal-title">Squares Locked In!</h2>
            <p style="text-align: center; color: rgba(255,255,255,0.7); margin-bottom: 10px;">
                You've successfully claimed <strong id="successCount">0</strong> squares!
            </p>
            <p style="text-align: center; color: var(--gold); font-size: 1.3rem; font-family: 'Oswald', sans-serif; margin-bottom: 20px;">
                Total Due: $<span id="successTotal">0</span>
            </p>
            <div class="payment-info">
                <p style="text-align: center; margin-bottom: 15px; color: rgba(255,255,255,0.6);">Please send payment to:</p>
                <div class="payment-method">
                    <div class="payment-icon">V</div>
                    <div class="payment-details">
                        <div class="payment-label">Venmo</div>
                        <div class="payment-value">@drew-labelle</div>
                    </div>
                </div>
                <div class="payment-method">
                    <div class="payment-icon">Z</div>
                    <div class="payment-details">
                        <div class="payment-label">Zelle</div>
                        <div class="payment-value">drewlabelle5@gmail.com</div>
                    </div>
                </div>
            </div>
            <button class="btn btn-primary" style="width: 100%;" id="closeSuccessBtn">Got It!</button>
        </div>
    </div>

    <!-- Admin Password Modal -->
    <div class="modal-overlay" id="passwordModal">
        <div class="modal">
            <h2 class="modal-title">Admin Access</h2>
            <input type="password" class="password-input" id="adminPassword" placeholder="Enter Admin Password">
            <div class="modal-actions">
                <button class="btn btn-secondary" id="cancelPasswordBtn">Cancel</button>
                <button class="btn btn-primary" id="submitPasswordBtn">Access Admin</button>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // FIREBASE CONFIGURATION
        // ============================================
        // IMPORTANT: Replace with your Firebase config
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyCw5hIv0bJIcnNXo58NspE7cZVckEu1p88",
  authDomain: "superbowl-squares-f381e.firebaseapp.com",
  databaseURL: "https://superbowl-squares-f381e-default-rtdb.firebaseio.com",
  projectId: "superbowl-squares-f381e",
  storageBucket: "superbowl-squares-f381e.firebasestorage.app",
  messagingSenderId: "1017356821100",
  appId: "1:1017356821100:web:4d1c66c37441510b166e49",
  measurementId: "G-4P5C6GL7SY"
};

        // Admin password
        const ADMIN_PASSWORD = "Bork55";

        // ============================================
        // APP STATE
        // ============================================
        let db = null;
        let isFirebaseConnected = false;
        let selectedSquares = new Set();
        let squaresData = {};
        let quarterNumbers = {
            1: { x: Array(10).fill('?'), y: Array(10).fill('?') },
            2: { x: Array(10).fill('?'), y: Array(10).fill('?') },
            3: { x: Array(10).fill('?'), y: Array(10).fill('?') },
            4: { x: Array(10).fill('?'), y: Array(10).fill('?') }
        };
        let participants = {};
        let isAdmin = false;
        let teamSettings = { 
            x: { name: 'NFC TEAM', bgColor: '#ffffff', textColor: '#0a0a0a' },
            y: { name: 'AFC TEAM', bgColor: '#D4AF37', textColor: '#0a0a0a' }
        };

        // ============================================
        // INITIALIZATION
        // ============================================
        document.addEventListener('DOMContentLoaded', () => {
            initializeApp();
        });

        async function initializeApp() {
            try {
                // Try to initialize Firebase
                if (firebaseConfig.apiKey !== "YOUR_API_KEY") {
                    firebase.initializeApp(firebaseConfig);
                    db = firebase.database();
                    isFirebaseConnected = true;
                    await loadDataFromFirebase();
                } else {
                    // Demo mode - use local storage
                    console.log("Running in demo mode (no Firebase configured)");
                    loadDataFromLocalStorage();
                }

                applyTeamColors();
                renderGrid();
                updateStats();
                setupEventListeners();

                document.getElementById('loadingState').style.display = 'none';
                document.getElementById('gridSection').style.display = 'block';

            } catch (error) {
                console.error("Initialization error:", error);
                document.getElementById('loadingState').style.display = 'none';
                document.getElementById('errorState').textContent = "Error loading data. Using local storage mode.";
                document.getElementById('errorState').style.display = 'block';
                loadDataFromLocalStorage();
                applyTeamColors();
                renderGrid();
                updateStats();
                setupEventListeners();
                document.getElementById('gridSection').style.display = 'block';
            }
        }

        // ============================================
        // DATA PERSISTENCE
        // ============================================
        async function loadDataFromFirebase() {
            const snapshot = await db.ref('/').once('value');
            const data = snapshot.val() || {};
            
            squaresData = data.squares || {};
            quarterNumbers = data.quarterNumbers || quarterNumbers;
            participants = data.participants || {};
            teamSettings = data.teamSettings || teamSettings;

            // Listen for real-time updates
            db.ref('/squares').on('value', (snapshot) => {
                squaresData = snapshot.val() || {};
                renderGrid();
                updateStats();
            });

            db.ref('/quarterNumbers').on('value', (snapshot) => {
                quarterNumbers = snapshot.val() || quarterNumbers;
                renderGrid();
                if (isAdmin) renderQuarterEditor();
            });

            db.ref('/participants').on('value', (snapshot) => {
                participants = snapshot.val() || {};
                if (isAdmin) renderAdminTable();
            });

            db.ref('/teamSettings').on('value', (snapshot) => {
                teamSettings = snapshot.val() || teamSettings;
                applyTeamColors();
                renderGrid();
                if (isAdmin) populateTeamSettingsForm();
            });
        }

        function loadDataFromLocalStorage() {
            const savedData = localStorage.getItem('superbowlSquares');
            if (savedData) {
                const data = JSON.parse(savedData);
                squaresData = data.squares || {};
                quarterNumbers = data.quarterNumbers || quarterNumbers;
                participants = data.participants || {};
                teamSettings = data.teamSettings || teamSettings;
            }
        }

        function saveData() {
            if (isFirebaseConnected) {
                db.ref('/').update({
                    squares: squaresData,
                    quarterNumbers: quarterNumbers,
                    participants: participants,
                    teamSettings: teamSettings
                });
            } else {
                localStorage.setItem('superbowlSquares', JSON.stringify({
                    squares: squaresData,
                    quarterNumbers: quarterNumbers,
                    participants: participants,
                    teamSettings: teamSettings
                }));
            }
        }

        function applyTeamColors() {
            document.documentElement.style.setProperty('--team-x-bg', teamSettings.x.bgColor);
            document.documentElement.style.setProperty('--team-x-text', teamSettings.x.textColor);
            document.documentElement.style.setProperty('--team-y-bg', teamSettings.y.bgColor);
            document.documentElement.style.setProperty('--team-y-text', teamSettings.y.textColor);
            
            document.getElementById('teamXName').textContent = teamSettings.x.name;
            document.getElementById('teamYName').textContent = teamSettings.y.name;
        }

        // ============================================
        // GRID RENDERING
        // ============================================
        function renderGrid() {
            const grid = document.getElementById('squaresGrid');
            grid.innerHTML = '';

            // Corner cell with team indicator
            const corner = document.createElement('div');
            corner.className = 'number-header corner';
            corner.innerHTML = `<span style="font-size: 0.65rem; color: #0a0a0a; text-align: center; line-height: 1.2;">NFC‚Üí<br>AFC‚Üì</span>`;
            grid.appendChild(corner);

            // Top row (X axis - team X numbers)
            for (let i = 0; i < 10; i++) {
                const header = document.createElement('div');
                header.className = 'number-header';
                header.innerHTML = `
                    <div class="quarter-numbers">
                        <div class="quarter-num q1">${quarterNumbers[1].x[i]}</div>
                        <div class="quarter-num q2">${quarterNumbers[2].x[i]}</div>
                        <div class="quarter-num q3">${quarterNumbers[3].x[i]}</div>
                        <div class="quarter-num q4">${quarterNumbers[4].x[i]}</div>
                    </div>
                `;
                grid.appendChild(header);
            }

            // Grid rows
            for (let y = 0; y < 10; y++) {
                // Row header (Y axis - team Y numbers)
                const rowHeader = document.createElement('div');
                rowHeader.className = 'row-header';
                rowHeader.innerHTML = `
                    <div class="quarter-numbers">
                        <div class="quarter-num q1">${quarterNumbers[1].y[y]}</div>
                        <div class="quarter-num q2">${quarterNumbers[2].y[y]}</div>
                        <div class="quarter-num q3">${quarterNumbers[3].y[y]}</div>
                        <div class="quarter-num q4">${quarterNumbers[4].y[y]}</div>
                    </div>
                `;
                grid.appendChild(rowHeader);

                // Squares
                for (let x = 0; x < 10; x++) {
                    const squareId = `${x}-${y}`;
                    const square = document.createElement('div');
                    square.className = 'square';
                    square.dataset.id = squareId;

                    if (squaresData[squareId]) {
                        square.classList.add('taken');
                        square.textContent = squaresData[squareId];
                    } else if (selectedSquares.has(squareId)) {
                        square.classList.add('selected');
                    }

                    square.addEventListener('click', () => handleSquareClick(squareId));
                    grid.appendChild(square);
                }
            }
        }

        // ============================================
        // SQUARE SELECTION
        // ============================================
        function handleSquareClick(squareId) {
            if (squaresData[squareId]) return; // Already taken

            if (selectedSquares.has(squareId)) {
                selectedSquares.delete(squareId);
            } else {
                selectedSquares.add(squareId);
            }

            renderGrid();
            updateSelectionPanel();
        }

        function updateSelectionPanel() {
            const panel = document.getElementById('selectionPanel');
            const count = selectedSquares.size;

            if (count > 0) {
                panel.classList.add('active');
                document.getElementById('selectedCount').textContent = count;
                document.getElementById('selectedTotal').textContent = count * 25;
            } else {
                panel.classList.remove('active');
            }
        }

        function clearSelection() {
            selectedSquares.clear();
            renderGrid();
            updateSelectionPanel();
        }

        // ============================================
        // PURCHASE FLOW
        // ============================================
        function showNameModal() {
            const count = selectedSquares.size;
            document.getElementById('summaryCount').textContent = count;
            document.getElementById('summaryTotal').textContent = count * 25;
            document.getElementById('nameModal').classList.add('active');
            document.getElementById('playerName').focus();
        }

        function hideNameModal() {
            document.getElementById('nameModal').classList.remove('active');
            document.getElementById('playerName').value = '';
        }

        function submitPurchase() {
            const name = document.getElementById('playerName').value.trim();
            if (!name) {
                alert('Please enter your name');
                return;
            }

            const count = selectedSquares.size;
            const total = count * 25;

            // Claim the squares
            selectedSquares.forEach(squareId => {
                squaresData[squareId] = name;
            });

            // Update participant record
            if (!participants[name]) {
                participants[name] = { squares: [], paid: false };
            }
            participants[name].squares = [
                ...participants[name].squares,
                ...Array.from(selectedSquares)
            ];

            // Save data
            saveData();

            // Show success modal
            document.getElementById('successCount').textContent = count;
            document.getElementById('successTotal').textContent = total;
            document.getElementById('successModal').classList.add('active');

            // Reset selection
            selectedSquares.clear();
            hideNameModal();
            renderGrid();
            updateSelectionPanel();
            updateStats();
        }

        // ============================================
        // STATS
        // ============================================
        function updateStats() {
            const taken = Object.keys(squaresData).length;
            const available = 100 - taken;

            document.getElementById('availableCount').textContent = available;
            document.getElementById('takenCount').textContent = taken;
        }

        // ============================================
        // NUMBERS SECTION
        // ============================================
        // ============================================
        // ADMIN FUNCTIONS
        // ============================================
        function showPasswordModal() {
            document.getElementById('passwordModal').classList.add('active');
            document.getElementById('adminPassword').focus();
        }

        function hidePasswordModal() {
            document.getElementById('passwordModal').classList.remove('active');
            document.getElementById('adminPassword').value = '';
        }

        function checkAdminPassword() {
            const password = document.getElementById('adminPassword').value;
            if (password === ADMIN_PASSWORD) {
                isAdmin = true;
                hidePasswordModal();
                showAdminPanel();
            } else {
                alert('Incorrect password');
            }
        }

        function showAdminPanel() {
            document.getElementById('gridSection').style.display = 'none';
            document.getElementById('adminSection').classList.add('active');
            populateTeamSettingsForm();
            renderQuarterEditor();
            renderAdminTable();
        }

        function hideAdminPanel() {
            document.getElementById('adminSection').classList.remove('active');
            document.getElementById('gridSection').style.display = 'block';
        }

        function populateTeamSettingsForm() {
            // Team X
            document.getElementById('teamXNameInput').value = teamSettings.x.name;
            document.getElementById('teamXBgColor').value = teamSettings.x.bgColor;
            document.getElementById('teamXTextColor').value = teamSettings.x.textColor;
            document.getElementById('teamXBgHex').textContent = teamSettings.x.bgColor;
            document.getElementById('teamXTextHex').textContent = teamSettings.x.textColor;
            updateTeamPreview('X');
            
            // Team Y
            document.getElementById('teamYNameInput').value = teamSettings.y.name;
            document.getElementById('teamYBgColor').value = teamSettings.y.bgColor;
            document.getElementById('teamYTextColor').value = teamSettings.y.textColor;
            document.getElementById('teamYBgHex').textContent = teamSettings.y.bgColor;
            document.getElementById('teamYTextHex').textContent = teamSettings.y.textColor;
            updateTeamPreview('Y');
        }

        function updateTeamPreview(team) {
            const preview = document.getElementById(`team${team}Preview`);
            const nameInput = document.getElementById(`team${team}NameInput`);
            const bgColor = document.getElementById(`team${team}BgColor`).value;
            const textColor = document.getElementById(`team${team}TextColor`).value;
            
            preview.textContent = nameInput.value || (team === 'X' ? 'NFC TEAM' : 'AFC TEAM');
            preview.style.backgroundColor = bgColor;
            preview.style.color = textColor;
        }

        function saveTeamSettings() {
            teamSettings.x.name = document.getElementById('teamXNameInput').value || 'NFC TEAM';
            teamSettings.x.bgColor = document.getElementById('teamXBgColor').value;
            teamSettings.x.textColor = document.getElementById('teamXTextColor').value;
            
            teamSettings.y.name = document.getElementById('teamYNameInput').value || 'AFC TEAM';
            teamSettings.y.bgColor = document.getElementById('teamYBgColor').value;
            teamSettings.y.textColor = document.getElementById('teamYTextColor').value;
            
            saveData();
            applyTeamColors();
            renderGrid();
            
            alert('Team settings saved!');
        }

        function renderQuarterEditor() {
            const container = document.getElementById('quarterEditor');
            container.innerHTML = '';

            for (let q = 1; q <= 4; q++) {
                const card = document.createElement('div');
                card.className = 'quarter-edit-card';
                card.innerHTML = `
                    <div class="quarter-edit-title">Quarter ${q}</div>
                    <div class="numbers-edit-row">
                        <div class="numbers-edit-label">${teamSettings.x.name} - Columns (0-9)</div>
                        <div class="numbers-edit-grid">
                            ${Array(10).fill(0).map((_, i) => `
                                <input type="text" class="number-input" 
                                    id="q${q}x${i}" 
                                    value="${quarterNumbers[q].x[i]}" 
                                    maxlength="1"
                                    data-quarter="${q}" data-team="x" data-index="${i}">
                            `).join('')}
                        </div>
                    </div>
                    <div class="numbers-edit-row">
                        <div class="numbers-edit-label">${teamSettings.y.name} - Rows (0-9)</div>
                        <div class="numbers-edit-grid">
                            ${Array(10).fill(0).map((_, i) => `
                                <input type="text" class="number-input" 
                                    id="q${q}y${i}" 
                                    value="${quarterNumbers[q].y[i]}" 
                                    maxlength="1"
                                    data-quarter="${q}" data-team="y" data-index="${i}">
                            `).join('')}
                        </div>
                    </div>
                    <div class="quarter-actions">
                        <button class="btn btn-secondary btn-small" onclick="randomizeQuarter(${q})">Random</button>
                        <button class="btn btn-secondary btn-small" onclick="clearQuarter(${q})">Clear</button>
                        <button class="btn btn-primary btn-small" onclick="saveQuarter(${q})">Save Q${q}</button>
                    </div>
                `;
                container.appendChild(card);
            }

            // Add event listeners to number inputs
            document.querySelectorAll('.number-input').forEach(input => {
                input.addEventListener('input', handleNumberInput);
                input.addEventListener('keydown', handleNumberKeydown);
            });
        }

        function handleNumberInput(e) {
            const input = e.target;
            let value = input.value;
            
            // Allow only 0-9 or ?
            if (value !== '?' && value !== '') {
                value = value.replace(/[^0-9]/g, '');
                if (value.length > 1) value = value[0];
                input.value = value;
            }
        }

        function handleNumberKeydown(e) {
            const input = e.target;
            const quarter = parseInt(input.dataset.quarter);
            const team = input.dataset.team;
            const index = parseInt(input.dataset.index);
            
            // Tab to next input
            if (e.key === 'Tab' || e.key === 'ArrowRight') {
                e.preventDefault();
                const nextIndex = index + 1;
                if (nextIndex < 10) {
                    document.getElementById(`q${quarter}${team}${nextIndex}`).focus();
                } else if (team === 'x') {
                    document.getElementById(`q${quarter}y0`).focus();
                }
            } else if (e.key === 'ArrowLeft') {
                e.preventDefault();
                const prevIndex = index - 1;
                if (prevIndex >= 0) {
                    document.getElementById(`q${quarter}${team}${prevIndex}`).focus();
                }
            }
        }

        function saveQuarter(quarter) {
            const xNumbers = [];
            const yNumbers = [];
            
            for (let i = 0; i < 10; i++) {
                const xVal = document.getElementById(`q${quarter}x${i}`).value || '?';
                const yVal = document.getElementById(`q${quarter}y${i}`).value || '?';
                xNumbers.push(xVal);
                yNumbers.push(yVal);
            }
            
            quarterNumbers[quarter] = { x: xNumbers, y: yNumbers };
            saveData();
            renderGrid();
            
            alert(`Quarter ${quarter} numbers saved!`);
        }

        function randomizeQuarter(quarter) {
            const numbers = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9];
            const xNumbers = shuffleArray([...numbers]);
            const yNumbers = shuffleArray([...numbers]);
            
            // Update inputs
            for (let i = 0; i < 10; i++) {
                document.getElementById(`q${quarter}x${i}`).value = xNumbers[i];
                document.getElementById(`q${quarter}y${i}`).value = yNumbers[i];
            }
        }

        function clearQuarter(quarter) {
            for (let i = 0; i < 10; i++) {
                document.getElementById(`q${quarter}x${i}`).value = '?';
                document.getElementById(`q${quarter}y${i}`).value = '?';
            }
        }

        function renderAdminTable() {
            const tbody = document.getElementById('adminTableBody');
            tbody.innerHTML = '';

            const names = Object.keys(participants);
            if (names.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: rgba(255,255,255,0.5);">No participants yet</td></tr>';
                return;
            }

            names.forEach(name => {
                const data = participants[name];
                const squareCount = data.squares.length;
                const total = squareCount * 25;
                const isPaid = data.paid;

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${name}</td>
                    <td>${squareCount}</td>
                    <td>$${total}</td>
                    <td><span class="status-badge ${isPaid ? 'status-paid' : 'status-pending'}">${isPaid ? 'Paid' : 'Pending'}</span></td>
                    <td><button class="toggle-btn" onclick="togglePaymentStatus('${name}')">${isPaid ? 'Mark Unpaid' : 'Mark Paid'}</button></td>
                `;
                tbody.appendChild(row);
            });
        }

        function togglePaymentStatus(name) {
            if (participants[name]) {
                participants[name].paid = !participants[name].paid;
                saveData();
                renderAdminTable();
            }
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function resetAllSquares() {
            if (confirm('Are you sure you want to reset ALL squares? This cannot be undone!')) {
                if (confirm('This will remove all participant data. Are you REALLY sure?')) {
                    squaresData = {};
                    participants = {};
                    saveData();
                    renderGrid();
                    renderAdminTable();
                    updateStats();
                }
            }
        }

        function exportData() {
            const data = {
                squares: squaresData,
                participants: participants,
                quarterNumbers: quarterNumbers,
                teamSettings: teamSettings,
                exportDate: new Date().toISOString()
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'superbowl-squares-export.json';
            a.click();
        }

        // ============================================
        // EVENT LISTENERS
        // ============================================
        function setupEventListeners() {
            // Selection panel
            document.getElementById('clearSelectionBtn').addEventListener('click', clearSelection);
            document.getElementById('confirmSelectionBtn').addEventListener('click', showNameModal);

            // Name modal
            document.getElementById('cancelNameBtn').addEventListener('click', hideNameModal);
            document.getElementById('submitNameBtn').addEventListener('click', submitPurchase);
            document.getElementById('playerName').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') submitPurchase();
            });

            // Success modal
            document.getElementById('closeSuccessBtn').addEventListener('click', () => {
                document.getElementById('successModal').classList.remove('active');
            });

            // Admin login button at bottom
            document.getElementById('adminLoginBtn').addEventListener('click', () => {
                if (isAdmin) {
                    showAdminPanel();
                } else {
                    showPasswordModal();
                }
            });

            // Password modal
            document.getElementById('cancelPasswordBtn').addEventListener('click', hidePasswordModal);
            document.getElementById('submitPasswordBtn').addEventListener('click', checkAdminPassword);
            document.getElementById('adminPassword').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') checkAdminPassword();
            });

            // Admin actions
            document.getElementById('resetGridBtn').addEventListener('click', resetAllSquares);
            document.getElementById('exportBtn').addEventListener('click', exportData);
            document.getElementById('backToGridBtn').addEventListener('click', hideAdminPanel);

            // Team settings
            document.getElementById('saveTeamSettingsBtn').addEventListener('click', saveTeamSettings);
            
            // Color pickers - Team X
            document.getElementById('teamXBgColor').addEventListener('input', (e) => {
                document.getElementById('teamXBgHex').textContent = e.target.value;
                updateTeamPreview('X');
            });
            document.getElementById('teamXTextColor').addEventListener('input', (e) => {
                document.getElementById('teamXTextHex').textContent = e.target.value;
                updateTeamPreview('X');
            });
            document.getElementById('teamXNameInput').addEventListener('input', () => updateTeamPreview('X'));
            
            // Color pickers - Team Y
            document.getElementById('teamYBgColor').addEventListener('input', (e) => {
                document.getElementById('teamYBgHex').textContent = e.target.value;
                updateTeamPreview('Y');
            });
            document.getElementById('teamYTextColor').addEventListener('input', (e) => {
                document.getElementById('teamYTextHex').textContent = e.target.value;
                updateTeamPreview('Y');
            });
            document.getElementById('teamYNameInput').addEventListener('input', () => updateTeamPreview('Y'));

            // Close modals on overlay click
            document.querySelectorAll('.modal-overlay').forEach(overlay => {
                overlay.addEventListener('click', (e) => {
                    if (e.target === overlay) {
                        overlay.classList.remove('active');
                    }
                });
            });
        }
    </script>
</body>
</html>
